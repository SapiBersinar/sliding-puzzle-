<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="game-title-meta">Permainan Gosok Bom</title>
    <!-- Tailwind CSS CDN for utility classes and responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for a clean, modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles for the body, font, and background */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            transition: background-color 0.3s ease-in-out; /* Smooth transition for theme change */
        }

        /* --- Theme-specific styles (Default/Light Theme) --- */
        body.theme-light { background-color: #e0e7ff; /* bg-indigo-100 */ color: #374151; /* text-gray-700 */ }
        body.theme-light #game-wrapper { background-color: #ffffff; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        body.theme-light #game-board-card { background-color: #000000; box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.5); }
        body.theme-light .card-overlay { background-color: #60a5fa; } /* Default blue for card back */
        body.theme-light .message-box { background-color: #ffffff; }
        body.theme-light .text-gray-800 { color: #1f2937; } /* For title and message text */
        body.theme-light .text-gray-700 { color: #374151; } /* For labels etc. */
        body.theme-light input { background-color: #ffffff; border-color: #d1d5db; }
        body.theme-light select { background-color: #ffffff; color: #374151; border-color: #d1d5db; }
        body.theme-light select option { background-color: #ffffff; color: #374151; }


        /* --- Dark Theme --- */
        body.theme-dark { background-color: #1a202c; /* Darker background */ color: #e2e8f0; /* Light text */ }
        body.theme-dark #game-wrapper { background-color: #2d3748; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1); }
        body.theme-dark #game-board-card { background-color: #1f2937; box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.7); }
        body.theme-dark .card-overlay { background-color: #4a5568; } /* Darker blue for card back */
        body.theme-dark .message-box { background-color: #2d3748; }
        body.theme-dark .text-gray-800 { color: #f7fafc; }
        body.theme-dark .text-gray-700 { color: #e2e8f0; }
        body.theme-dark input { background-color: #4a5568; border-color: #64748b; color: #e2e8f0; }
        body.theme-dark input::placeholder { color: #a0aec0; }
        body.theme-dark select { background-color: #4a5568; color: #e2e8f0; border-color: #64748b; }
        body.theme-dark select option { background-color: #4a5568; color: #e2e8f0; }


        /* --- Forest Theme --- */
        body.theme-forest { background-color: #2a523e; /* Deep forest green */ color: #e0e0e0; }
        body.theme-forest #game-wrapper { background-color: #4CAF50; /* Brighter green, but still natural */ box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.08); }
        body.theme-forest #game-board-card { background-color: #1a3a2e; /* Very dark green */ box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.6); }
        body.theme-forest .card-overlay { background-color: #388E3C; /* Darker, more muted green for card back */ }
        body.theme-forest .message-box { background-color: #4CAF50; }
        body.theme-forest .text-gray-800 { color: #ffffff; }
        body.theme-forest .text-gray-700 { color: #f0f0f0; }
        body.theme-forest input { background-color: #388E3C; border-color: #81C784; color: #ffffff; }
        body.theme-forest input::placeholder { color: #c8e6c9; }
        body.theme-forest select { background-color: #388E3C; color: #ffffff; border-color: #81C784; }
        body.theme-forest select option { background-color: #388E3C; color: #ffffff; }


        /* Styling for the main game wrapper card */
        #game-wrapper {
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 100%;
            margin: 2rem auto;
            text-align: center;
            transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        /* Styling for the game board container (the new card for the game cards) */
        #game-board-card {
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1.5rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        /* Styling for each card container (outer wrapper) */
        .card-container {
            position: relative;
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio to make cards square */
            border-radius: 0.75rem;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            background-color: transparent;
        }
        /* Hover effect for cards */
        .card-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

        /* New inner div for the card content that will be white */
        .card-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff; /* This is the white background when revealed */
            border-radius: inherit;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            z-index: 1;
        }

        /* Styling for the image inside each card */
        .card-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 0.5rem;
        }

        /* Styling for the overlay that covers the card content */
        .card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0.75rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            font-size: 2rem;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out, background-color 0.3s ease-in-out;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            z-index: 2;
        }
        /* Class to hide the overlay with a flip animation */
        .card-overlay.hidden-overlay {
            opacity: 0;
            transform: rotateY(180deg); /* Flips the card to reveal content */
            pointer-events: none; /* Crucial: Allows clicks to pass through after hidden */
        }
        /* Styling for the number on the card overlay */
        .card-number {
            position: absolute;
            font-size: 3rem; /* Larger font size for visibility */
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* Add shadow for better contrast */
            transition: opacity 0.3s ease-in-out; /* Smooth transition for number disappearing */
        }
        .card-number.hidden {
            opacity: 0;
        }


        /* Styling for the game message box (modal) */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            display: none;
        }
        /* Class to show the message box */
        .message-box.show {
            display: block;
        }

        /* --- Animasi Judul (Promosi) --- */
        @keyframes pulse-promo {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.03); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        .promo-title {
            animation: pulse-promo 2s infinite ease-in-out;
        }

        /* --- Animasi Bom --- */
        @keyframes bomb-shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-1deg); }
            50% { transform: translateX(5px) rotate(1deg); }
            75% { transform: translateX(-5px) rotate(-1deg); }
            100% { transform: translateX(0); }
        }
        .bomb-revealed .card-image {
            animation: bomb-shake 0.3s ease-in-out 3;
        }

        /* --- Animasi Kartu Non-Bom (Safe Reveal) --- */
        @keyframes safe-pulse-glow {
            0% { transform: scale(1); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
            50% { transform: scale(1.02); box-shadow: 0 0 55px rgba(0, 255, 0, 1); } /* Stronger glow intensity */
            100% { transform: scale(1); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        }
        .card-container.safe-revealed {
            animation: safe-pulse-glow 0.4s ease-out;
        }

        /* --- Animasi Kemenangan (Confetti) --- */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f0f; /* Pink */
            opacity: 0;
            animation: confetti-fall 2s forwards;
            border-radius: 50%; /* For round confetti */
            z-index: 999;
        }
        @keyframes confetti-fall {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--x), var(--y)) rotate(720deg); opacity: 0; }
        }

        /* Hide the default file input button */
        .file-input-hidden {
            display: none;
        }
        /* Style the label to look like a button */
        .upload-button {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: #4f46e5;
            color: white;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease-in-out;
        }
        .upload-button:hover {
            background-color: #4338ca;
        }

        /* Debugging Panel Styles (Modal) */
        #debug-panel, #help-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Above everything */
            display: none; /* Hidden by default */
        }
        #debug-panel.show, #help-panel.show {
            display: flex; /* Use flex to center content */
        }
        #debug-content, #help-content {
            background-color: rgba(0, 0, 0, 0.9); /* Darker content background */
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto; /* Scrollable if content overflows */
            font-family: monospace;
            font-size: 0.9rem;
            text-align: left;
            position: relative; /* For close button positioning */
        }
        #debug-content h3, #help-content h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #6ee7b7; /* Light green for heading */
        }
        #debug-content p, #help-content p {
            margin-bottom: 0.5rem;
        }
        #debug-close-button, #help-close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #fff;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }
        #debug-toggle-button {
            position: fixed;
            bottom: 0;
            right: 0;
            background-color: #dc2626; /* Red */
            color: white;
            padding: 0.5rem 1rem;
            border-top-left-radius: 0.5rem;
            cursor: pointer;
            z-index: 1002; /* Above debug panel */
        }

        /* --- Help Table Styles --- */
        #help-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        #help-content th, #help-content td {
            border: 1px solid #4a5568; /* Darker border for table */
            padding: 0.75rem;
            text-align: left;
            vertical-align: top;
        }
        #help-content th {
            background-color: #2d3748; /* Darker header background */
            color: #6ee7b7;
            font-weight: bold;
        }
        #help-content tr:nth-child(even) {
            background-color: #1f2937; /* Alternate row color */
        }
        #help-content tr:hover {
            background-color: #374151; /* Hover effect for rows */
        }

        /* --- Promo Mode Specific Styles --- */
        body.promo-mode .hide-on-promo {
            display: none !important;
        }
    </style>
</head>
<body class="theme-light">

    <!-- Main game wrapper card -->
    <div id="game-wrapper">
        <!-- Game title with promo animation -->
        <h1 id="game-title" class="text-4xl font-bold text-gray-800 mb-8 promo-title">Permainan Gosok Bom</h1>

        <!-- Theme Selection -->
        <div class="mb-4 hide-on-promo">
            <label for="theme-select" class="block text-sm font-medium text-gray-700 mb-2" id="label-theme-select">Pilih Tema Visual:</label>
            <select id="theme-select" class="px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="light" id="option-light">Terang (Default)</option>
                <option value="dark" id="option-dark">Gelap</option>
                <option value="forest" id="option-forest">Hutan</option>
            </select>
        </div>

        <!-- Image Upload Section -->
        <div class="flex flex-wrap justify-center gap-4 mb-6 hide-on-promo">
            <div>
                <label for="background-upload" class="upload-button" id="label-upload-board-bg">
                    Unggah Latar Belakang Papan
                </label>
                <input type="file" id="background-upload" accept="image/*" class="file-input-hidden">
            </div>
            <div>
                <label for="bomb-image-upload" class="upload-button" id="label-upload-bomb-img">
                    Unggah Gambar Bom
                </label>
                <input type="file" id="bomb-image-upload" accept="image/*" class="file-input-hidden">
            </div>
            <div>
                <label for="non-bomb-image-upload" class="upload-button" id="label-upload-non-bomb-img">
                    Unggah Gambar Bukan Bom
                </label>
                <input type="file" id="non-bomb-image-upload" accept="image/*" class="file-input-hidden">
            </div>
        </div>

        <!-- Game board container (the new card for the game cards) -->
        <div id="game-board-card">
            <!-- Game board grid container -->
            <div id="game-board" class="grid grid-cols-3 gap-4 max-w-lg w-full mx-auto">
                <!-- Cards will be injected here by JavaScript -->
            </div>
        </div>

        <!-- Password input section -->
        <div class="mt-6">
            <input type="text" id="password-input" placeholder="terminal"
                   class="px-4 py-2 rounded-md border focus:outline-none focus:ring-2 focus:ring-blue-500 w-full max-w-xs text-center">
            <button id="reveal-bomb-button"
                    class="mt-3 px-4 py-2 bg-indigo-600 text-white font-bold rounded-md shadow-md hover:bg-indigo-700 transition duration-300 ease-in-out">
                Enter / Click
            </button>
        </div>

        <!-- Action buttons -->
        <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8 hide-on-promo">
            <button id="shuffle-button" class="px-6 py-3 bg-green-600 text-white font-bold rounded-full shadow-lg hover:bg-green-700 transition duration-300 ease-in-out transform hover:scale-105">
                Acak Permainan
            </button>
            <button id="reset-button" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105">
                Mulai Ulang Permainan
            </button>
        </div>
    </div>

    <!-- Message box for game status (win/lose) -->
    <div id="message-box" class="message-box">
        <p id="message-text" class="text-2xl font-semibold text-gray-800 mb-4"></p>
        <button id="close-message" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200" id="button-close-message">Oke</button>
    </div>

    <!-- Debugging Panel Toggle Button -->
    <button id="debug-toggle-button" class="hide-on-promo">Debug</button>

    <!-- Debugging Panel (Modal Structure) -->
    <div id="debug-panel">
        <div id="debug-content">
            <button id="debug-close-button">&times;</button>
            <h3 id="debug-panel-title">Panel Debugging</h3>
            <p><span id="debug-label-bomb-index">Lokasi Bom (1-indexed):</span> <span id="debug-bomb-index"></span></p>
            <p><span id="debug-label-revealed-count">Kartu Terbuka:</span> <span id="debug-revealed-count"></span></p>
            <p><span id="debug-label-is-game-over">Permainan Selesai:</span> <span id="debug-is-game-over"></span></p>
            <p><span id="debug-label-active-theme">Tema Aktif:</span> <span id="debug-active-theme"></span></p>
            <p><span id="debug-label-bomb-url">URL Bom:</span> <span id="debug-bomb-url"></span></p>
            <p><span id="debug-label-non-bomb-url">URL Bukan Bom:</span> <span id="debug-non-bomb-url"></span></p>
            <p><span id="debug-label-error-messages">Pesan Kesalahan/Peringatan:</span> <span id="debug-error-messages" class="text-red-400"></span></p>
        </div>
    </div>

    <!-- Help Panel (Modal Structure) -->
    <div id="help-panel">
        <div id="help-content">
            <button id="help-close-button">&times;</button>
            <h3 id="help-panel-title">Daftar Perintah</h3>
            <table id="commands-table">
                <thead>
                    <tr>
                        <th id="table-header-command">Perintah</th>
                        <th id="table-header-description">Deskripsi</th>
                    </tr>
                </thead>
                <tbody id="commands-table-body">
                    <!-- Commands will be injected here by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Language Translations
        const translations = {
            id: {
                gameTitle: "Permainan Gosok Bom",
                selectTheme: "Pilih Tema Visual:",
                uploadBoardBg: "Unggah Latar Belakang Papan",
                uploadBombImg: "Unggah Gambar Bom",
                uploadNonBombImg: "Unggah Gambar Bukan Bom",
                terminalPlaceholder: "terminal",
                enterClickButton: "Enter / Click",
                shuffleGame: "Acak Permainan",
                resetGame: "Mulai Ulang Permainan",
                youLose: "Anda kalah! Anda menemukan bom.",
                youWin: (bombIndex) => `Selamat! Anda menang! Bom berada di kartu nomor ${bombIndex}.`,
                invalidSecretCode: "Kode rahasia atau perintah tidak valid.",
                bombLocation: (bombIndex) => `Kode bom berada di kartu nomor ${bombIndex}.`,
                cardNumberHidden: "Angka kartu disembunyikan.",
                promoModeActivated: "Mode promosi diaktifkan. UI disembunyikan.",
                uiRestored: "Semua elemen UI ditampilkan kembali.",
                gameReset: "Permainan diulang.",
                gameShuffled: "Permainan diacak ulang (warna papan tetap).",
                smoothBgActivated: "Latar belakang papan dihaluskan, warna kartu diacak.",
                showingAllNumbers: "Menampilkan semua angka kartu.",
                showingSpecificNumber: (num) => `Menampilkan angka kartu ${num}.`,
                invalidNumberFormat: 'Format angka tidak valid. Gunakan "Angka(<nomor>)" contoh: Angka(2).',
                unknownCommand: (cmd) => `Perintah tidak dikenal: "${cmd}"`,
                debugPanelTitle: "Panel Debugging",
                debugBombIndex: "Lokasi Bom (1-indexed):",
                debugRevealedCount: "Kartu Terbuka:",
                debugIsGameOver: "Permainan Selesai:",
                debugActiveTheme: "Tema Aktif:",
                debugBombUrl: "URL Bom:",
                debugNonBombUrl: "URL Bukan Bom:",
                debugErrorMessages: "Pesan Kesalahan/Peringatan:",
                debugButton: "Debug",
                hideDebugButton: "Sembunyikan Debug",
                debugCloseButton: "&times;",
                helpPanelTitle: "Daftar Perintah",
                tableHeaderCommand: "Perintah",
                tableHeaderDescription: "Deskripsi",
                // Commands (lowercase for matching)
                cmd_debug: "debug",
                cmd_clear: "clear",
                cmd_promo_hide: "0000",
                cmd_promo_show: "-0",
                cmd_reset: "reset",
                cmd_restart_game: "mulai ulang permainan",
                cmd_shuffle: "lagi",
                cmd_smooth_bg: "0099",
                cmd_show_all_numbers: "angka",
                cmd_show_specific_number_prefix: "angka(",
                cmd_show_specific_number_suffix: ")",
                cmd_secret_code: "0091",
                cmd_help: "!",
                cmd_lang_en: "en",
                cmd_lang_id: "id",
                helpCommands: [
                    { cmd: "0091", desc: "Lihat lokasi bom." },
                    { cmd: "debug", desc: "Buka panel debugging." },
                    { cmd: "clear", desc: "Sembunyikan semua angka kartu." },
                    { cmd: "0000", desc: "Aktifkan mode promosi (sembunyikan UI)." },
                    { cmd: "-0", desc: "Nonaktifkan mode promosi (tampilkan UI)." },
                    { cmd: "reset / mulai ulang permainan", desc: "Mulai permainan baru." },
                    { cmd: "lagi", desc: "Acak ulang kartu (warna papan tetap)." },
                    { cmd: "0099", desc: "Haluskan latar belakang papan (warna kartu diacak)." },
                    { cmd: "angka", desc: "Tampilkan semua angka kartu." },
                    { cmd: "angka(<nomor>)", desc: "Tampilkan angka kartu tertentu (contoh: angka(5))." },
                    { cmd: "En", desc: "Ubah bahasa ke Inggris." },
                    { cmd: "Id", desc: "Ubah bahasa ke Indonesia." },
                    { cmd: "!", desc: "Tampilkan daftar perintah ini." }
                ]
            },
            en: {
                gameTitle: "Bomb Scratch Game",
                selectTheme: "Select Visual Theme:",
                uploadBoardBg: "Upload Board Background",
                uploadBombImg: "Upload Bomb Image",
                uploadNonBombImg: "Upload Non-Bomb Image",
                terminalPlaceholder: "terminal",
                enterClickButton: "Enter / Click",
                shuffleGame: "Shuffle Game",
                resetGame: "Restart Game",
                youLose: "You lost! You found the bomb.",
                youWin: (bombIndex) => `Congratulations! You won! The bomb was at card number ${bombIndex}.`,
                invalidSecretCode: "Invalid secret code or command.",
                bombLocation: (bombIndex) => `The bomb code is at card number ${bombIndex}.`,
                cardNumberHidden: "Card numbers hidden.",
                promoModeActivated: "Promotion mode activated. UI hidden.",
                uiRestored: "All UI elements restored.",
                gameReset: "Game restarted.",
                gameShuffled: "Game shuffled (board color remains).",
                smoothBgActivated: "Board background smoothed, card colors shuffled.",
                showingAllNumbers: "Showing all card numbers.",
                showingSpecificNumber: (num) => `Showing card number ${num}.`,
                invalidNumberFormat: 'Invalid number format. Use "Number(<number>)" e.g.: Number(2).',
                unknownCommand: (cmd) => `Unknown command: "${cmd}"`,
                debugPanelTitle: "Debugging Panel",
                debugBombIndex: "Bomb Location (1-indexed):",
                debugRevealedCount: "Cards Revealed:",
                debugIsGameOver: "Game Over:",
                debugActiveTheme: "Active Theme:",
                debugBombUrl: "Bomb URL:",
                debugNonBombUrl: "Non-Bomb URL:",
                debugErrorMessages: "Error/Warning Messages:",
                debugButton: "Debug",
                hideDebugButton: "Hide Debug",
                debugCloseButton: "&times;",
                helpPanelTitle: "Command List",
                tableHeaderCommand: "Command",
                tableHeaderDescription: "Description",
                // Commands (lowercase for matching)
                cmd_debug: "debug",
                cmd_clear: "clear",
                cmd_promo_hide: "0000",
                cmd_promo_show: "-0",
                cmd_reset: "reset",
                cmd_restart_game: "restart game",
                cmd_shuffle: "again",
                cmd_smooth_bg: "0099",
                cmd_show_all_numbers: "number",
                cmd_show_specific_number_prefix: "number(",
                cmd_show_specific_number_suffix: ")",
                cmd_secret_code: "0091",
                cmd_help: "!",
                cmd_lang_en: "en",
                cmd_lang_id: "id",
                helpCommands: [
                    { cmd: "0091", desc: "See bomb location." },
                    { cmd: "debug", desc: "Open debugging panel." },
                    { cmd: "clear", desc: "Hide all card numbers." },
                    { cmd: "0000", desc: "Activate promotion mode (hide UI)." },
                    { cmd: "-0", desc: "Deactivate promotion mode (show UI)." },
                    { cmd: "reset / restart game", desc: "Start a new game." },
                    { cmd: "again", desc: "Shuffle cards (board color remains)." },
                    { cmd: "0099", desc: "Smooth board background (card colors shuffled)." },
                    { cmd: "number", desc: "Show all card numbers." },
                    { cmd: "number(<number>)", desc: "Show specific card number (e.g.: number(5))." },
                    { cmd: "En", desc: "Change language to English." },
                    { cmd: "Id", desc: "Change language to Indonesian." },
                    { cmd: "!", desc: "Show this command list." }
                ]
            }
        };

        // Constants for image URLs and game configuration
        let BOMB_IMAGE_URL = "https://raw.githubusercontent.com/SapiBersinar/hanzercopy.cloud/refs/heads/main/gambar-ai/2.png";
        let NON_BOMB_IMAGE_URL = "https://raw.githubusercontent.com/SapiBersinar/hanzercopy.cloud/refs/heads/main/gambar-ai/1.png";
        const TOTAL_CARDS = 12; // Total number of cards on the board
        const BOMB_COUNT = 1;   // Number of bombs in the game

        // Local Storage Keys
        const BACKGROUND_STORAGE_KEY = 'bombGameBackground';
        const BOMB_IMAGE_STORAGE_KEY = 'bombCustomBombImage';
        const NON_BOMB_IMAGE_STORAGE_KEY = 'bombCustomNonBombImage';
        const THEME_STORAGE_KEY = 'bombGameTheme';
        const LANGUAGE_STORAGE_KEY = 'bombGameLanguage'; // New storage key for language

        // Predefined colors for random selection (for card overlays)
        const CARD_OVERLAY_COLORS = ['#FFA500', '#60a5fa', '#f87171', '#fbbf24', '#a78bfa', '#34d399', '#f472b6']; // Orange added as default, plus others

        // Game state variables
        let bombIndex = -1;
        let isGameOver = false;
        let revealedCount = 0;
        let activeTheme = 'light';
        let isPromoModeActive = false; // Global state for promo mode
        let currentLang = 'id'; // Default language

        // DOM element references (declared here, assigned in window.onload)
        let gameTitleMeta;
        let gameTitle;
        let labelThemeSelect;
        let optionLight;
        let optionDark;
        let optionForest;
        let labelUploadBoardBg;
        let labelUploadBombImg;
        let labelUploadNonBombImg;
        let gameBoard;
        let gameBoardCard;
        let backgroundUpload;
        let bombImageUpload;
        let nonBombImageUpload;
        let passwordInput;
        let revealBombButton;
        let shuffleButton;
        let resetButton;
        let messageBox;
        let messageText;
        let closeMessageButton;
        let themeSelect;

        let debugToggleButton;
        let debugPanel;
        let debugCloseButton;
        let debugPanelTitle;
        let debugLabelBombIndex;
        let debugBombIndex;
        let debugLabelRevealedCount;
        let debugRevealedCount;
        let debugLabelIsGameOver;
        let debugIsGameOver;
        let debugLabelActiveTheme;
        let debugActiveTheme;
        let debugLabelBombUrl;
        let debugBombUrl;
        let debugLabelNonBombUrl;
        let debugNonBombUrl;
        let debugLabelErrorMessages;
        let debugErrorMessages;

        let helpPanel; // New help panel elements
        let helpCloseButton;
        let helpPanelTitle;
        let commandsTableBody;
        let tableHeaderCommand;
        let tableHeaderDescription;


        /**
         * Updates the debugging panel with current game state.
         */
        function updateDebugPanel() {
            debugBombIndex.textContent = bombIndex + 1; // +1 for user-friendly 1-indexed
            debugRevealedCount.textContent = revealedCount;
            debugIsGameOver.textContent = isGameOver ? translations[currentLang].debugIsGameOver.split(':')[1].trim() : (currentLang === 'id' ? 'Tidak' : 'No');
            debugActiveTheme.textContent = activeTheme;
            debugBombUrl.textContent = BOMB_IMAGE_URL;
            debugNonBombUrl.textContent = NON_BOMB_IMAGE_URL;
        }

        /**
         * Logs a message to the debug panel's error messages section.
         * @param {string} message - The error or warning message.
         */
        function logDebugError(message) {
            debugErrorMessages.textContent = message;
        }

        /**
         * Clears error messages from the debug panel.
         */
        function clearDebugErrors() {
            debugErrorMessages.textContent = '';
        }

        /**
         * Sets the current language and updates all UI texts.
         * @param {string} langCode - 'id' for Indonesian, 'en' for English.
         */
        function setLanguage(langCode) {
            currentLang = langCode;
            localStorage.setItem(LANGUAGE_STORAGE_KEY, langCode);
            document.documentElement.lang = langCode; // Update HTML lang attribute

            const t = translations[langCode];

            // Update meta title
            gameTitleMeta.textContent = t.gameTitle;
            // Update main title
            gameTitle.textContent = t.gameTitle;
            // Update theme selection
            labelThemeSelect.textContent = t.selectTheme;
            optionLight.textContent = langCode === 'id' ? 'Terang (Default)' : 'Light (Default)';
            optionDark.textContent = langCode === 'id' ? 'Gelap' : 'Dark';
            optionForest.textContent = langCode === 'id' ? 'Hutan' : 'Forest';
            // Update upload labels
            labelUploadBoardBg.textContent = t.uploadBoardBg;
            labelUploadBombImg.textContent = t.uploadBombImg;
            labelUploadNonBombImg.textContent = t.uploadNonBombImg;
            // Update terminal input
            passwordInput.placeholder = t.terminalPlaceholder;
            revealBombButton.textContent = t.enterClickButton;
            // Update action buttons
            shuffleButton.textContent = t.shuffleGame;
            resetButton.textContent = t.resetGame;
            // Update message box button
            closeMessageButton.textContent = langCode === 'id' ? 'Oke' : 'Okay';
            // Update debug button
            debugToggleButton.textContent = t.debugButton;
            // Update debug panel
            debugPanelTitle.textContent = t.debugPanelTitle;
            debugLabelBombIndex.textContent = t.debugBombIndex;
            debugLabelRevealedCount.textContent = t.debugRevealedCount;
            debugLabelIsGameOver.textContent = t.debugIsGameOver;
            debugLabelActiveTheme.textContent = t.debugActiveTheme;
            debugLabelBombUrl.textContent = t.debugBombUrl;
            debugLabelNonBombUrl.textContent = t.debugNonBombUrl;
            debugLabelErrorMessages.textContent = t.debugErrorMessages;
            // Update help panel
            helpPanelTitle.textContent = t.helpPanelTitle;
            tableHeaderCommand.textContent = t.tableHeaderCommand;
            tableHeaderDescription.textContent = t.tableHeaderDescription;
            populateHelpTable(); // Repopulate table with new language

            updateDebugPanel(); // Update debug panel content with new language
            // If a message box is open, update its text
            if (messageBox.classList.contains('show')) {
                if (isGameOver) {
                    if (revealedCount === (TOTAL_CARDS - BOMB_COUNT)) {
                        showMessage(t.youWin(bombIndex + 1));
                    } else {
                        showMessage(t.youLose);
                    }
                } else {
                    hideMessage(); // Hide if no specific game state message
                }
            }
        }

        /**
         * Populates the help table with commands for the current language.
         */
        function populateHelpTable() {
            commandsTableBody.innerHTML = ''; // Clear existing rows
            const t = translations[currentLang];
            t.helpCommands.forEach(item => {
                const row = commandsTableBody.insertRow();
                const cmdCell = row.insertCell();
                const descCell = row.insertCell();
                cmdCell.textContent = item.cmd;
                descCell.textContent = item.desc;
            });
        }


        /**
         * Applies the selected theme to the body.
         * @param {string} themeName - The name of the theme (e.g., 'light', 'dark').
         */
        function applyTheme(themeName) {
            document.body.classList.remove('theme-light', 'theme-dark', 'theme-forest');
            document.body.classList.add(`theme-${themeName}`);
            activeTheme = themeName;
            localStorage.setItem(THEME_STORAGE_KEY, themeName);
            updateDebugPanel();
        }

        /**
         * Toggles the visibility of a specific card number or all card numbers.
         * @param {number|'all'|null} command - The 1-indexed number of the card to show, 'all' to show all, or null to hide all.
         */
        function toggleCardNumberVisibility(command = null) {
            const cardNumbers = document.querySelectorAll('.card-number');
            cardNumbers.forEach((span, index) => {
                if (command === 'all') {
                    span.classList.remove('hidden');
                } else if (typeof command === 'number' && parseInt(command) === (index + 1)) {
                    span.classList.remove('hidden');
                } else {
                    span.classList.add('hidden');
                }
            });
        }

        /**
         * Initializes the game board by creating cards, assigning bomb position,
         * and setting up event listeners.
         * @param {string} mode - The mode of initialization: 'initial', 'reset', 'shuffle', 'lagi', 'smooth-bg', '0000_activate', '-0_deactivate'.
         */
        function initializeGame(mode = 'initial') {
            gameBoard.innerHTML = '';
            isGameOver = false;
            revealedCount = 0;
            bombIndex = Math.floor(Math.random() * TOTAL_CARDS);
            clearDebugErrors();

            // --- Handle Promo Mode Persistence ---
            if (mode === 'initial' || mode === 'reset') {
                isPromoModeActive = false; // Reset promo mode on full game reset/initial load
                document.body.classList.remove('promo-mode');
            } else if (mode === '0000_activate') { // Explicit activation from terminal
                isPromoModeActive = true;
                document.body.classList.add('promo-mode');
            } else if (mode === '-0_deactivate') { // Explicit deactivation from terminal
                isPromoModeActive = false;
                document.body.classList.remove('promo-mode');
            }
            // For 'lagi', 'shuffle', 'smooth-bg', promo mode state is preserved from `isPromoModeActive`


            // Load custom images or use defaults for bomb/non-bomb
            BOMB_IMAGE_URL = localStorage.getItem(BOMB_IMAGE_STORAGE_KEY) || "https://raw.githubusercontent.com/SapiBersinar/hanzercopy.cloud/refs/heads/main/gambar-ai/2.png";
            NON_BOMB_IMAGE_URL = localStorage.getItem(NON_BOMB_IMAGE_STORAGE_KEY) || "https://raw.githubusercontent.com/SapiBersinar/hanzercopy.cloud/refs/heads/main/gambar-ai/1.png";

            // --- Board Background Color/Image Logic ---
            const savedBackground = localStorage.getItem(BACKGROUND_STORAGE_KEY);
            if (savedBackground) { // If custom background is saved, always use it
                gameBoardCard.style.backgroundImage = `url('${savedBackground}')`;
                gameBoardCard.style.backgroundColor = 'transparent'; // Ensure transparency for image
            } else { // No custom background, always default to black
                gameBoardCard.style.backgroundImage = 'none';
                gameBoardCard.style.backgroundColor = '#000000'; // Default black
            }

            // --- Card Overlay Color Logic ---
            let currentOverlayColor;
            if (mode === 'initial' || mode === 'reset' || mode === 'smooth-bg' || mode === '0000_activate' || mode === '-0_deactivate') {
                currentOverlayColor = '#FFA500'; // Default orange for cards on init, reset, smooth-bg, and promo mode changes
            } else { // 'shuffle' or 'lagi'
                currentOverlayColor = CARD_OVERLAY_COLORS[Math.floor(Math.random() * CARD_OVERLAY_COLORS.length)];
            }

            // Loop to create each card element
            for (let i = 0; i < TOTAL_CARDS; i++) {
                const cardContainer = document.createElement('div');
                cardContainer.classList.add('card-container');
                cardContainer.dataset.index = i;

                const cardInner = document.createElement('div');
                cardInner.classList.add('card-inner');

                const cardImage = document.createElement('img');
                cardImage.classList.add('card-image');
                cardImage.src = (i === bombIndex) ? BOMB_IMAGE_URL : NON_BOMB_IMAGE_URL;
                cardImage.alt = (i === bombIndex) ? 'Bom' : 'Bukan Bom';

                cardInner.appendChild(cardImage);

                const cardOverlay = document.createElement('div');
                cardOverlay.classList.add('card-overlay');
                cardOverlay.style.backgroundColor = currentOverlayColor; // Apply determined color to overlay

                // Add the card number to the overlay (initially hidden)
                const cardNumberSpan = document.createElement('span');
                cardNumberSpan.classList.add('card-number', 'hidden'); // Hidden by default
                cardNumberSpan.textContent = i + 1; // Display 1-indexed number
                cardOverlay.appendChild(cardNumberSpan);

                cardContainer.appendChild(cardInner);
                cardContainer.appendChild(cardOverlay);

                cardContainer.addEventListener('click', handleCardClick);
                gameBoard.appendChild(cardContainer);
            }
            updateDebugPanel();
            toggleCardNumberVisibility(null); // Ensure all numbers are hidden on init
        }

        /**
         * Handles the click event when a card is clicked.
         * @param {Event} event - The click event object.
         */
        function handleCardClick(event) {
            // No longer return if isGameOver, allow clicking other cards after losing
            // The isGameOver flag now primarily controls the win condition and game restart logic

            const clickedCard = event.currentTarget;
            const cardOverlay = clickedCard.querySelector('.card-overlay');

            if (cardOverlay.classList.contains('hidden-overlay')) {
                return; // Prevent re-clicking already revealed cards
            }

            const index = parseInt(clickedCard.dataset.index);
            cardOverlay.classList.add('hidden-overlay');

            cardOverlay.addEventListener('transitionend', () => {
                if (index === bombIndex) {
                    isGameOver = true; // Game is over
                    clickedCard.classList.add('bomb-revealed'); // Animate the bomb card
                    setTimeout(() => {
                        showMessage(translations[currentLang].youLose); // Show lose message
                        // Do NOT reveal all cards here. Only the bomb is shown.
                    }, 500);
                } else {
                    if (!isGameOver) { // Only count revealed cards and check win condition if game is not already over
                        revealedCount++;
                        clickedCard.classList.add('safe-revealed');
                        clickedCard.addEventListener('animationend', () => {
                            clickedCard.classList.remove('safe-revealed');
                        }, { once: true });

                        if (revealedCount === (TOTAL_CARDS - BOMB_COUNT)) {
                            isGameOver = true;
                            showMessage(translations[currentLang].youWin(bombIndex + 1)); // Explicitly state bomb location
                            triggerWinAnimation(); // Trigger victory animation
                            // Add temporary highlight to the bomb card
                            const bombCard = gameBoard.querySelector(`[data-index="${bombIndex}"]`);
                            if (bombCard) {
                                bombCard.style.border = '3px solid gold'; // Temporary visual highlight
                                bombCard.style.boxShadow = '0 0 20px gold';
                                setTimeout(() => {
                                    bombCard.style.border = '';
                                    bombCard.style.boxShadow = '';
                                }, 3000); // Remove highlight after 3 seconds
                            }
                        }
                    } else {
                        // If game is already over (due to bomb), just reveal the card without further game logic
                        clickedCard.classList.add('safe-revealed'); // Still show safe animation
                        clickedCard.addEventListener('animationend', () => {
                            clickedCard.classList.remove('safe-revealed');
                        }, { once: true });
                    }
                }
                updateDebugPanel();
            }, { once: true });
        }

        /**
         * Displays a message in the modal box.
         * @param {string} message - The message text to display.
         */
        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.add('show');
            // Clear any debug errors when a new game message is shown
            clearDebugErrors();
        }

        /**
         * Hides the message modal box.
         */
        function hideMessage() {
            messageBox.classList.remove('show');
        }

        /**
         * Triggers a simple confetti-like victory animation.
         */
        function triggerWinAnimation() {
            const colors = ['#f0f', '#0ff', '#ff0', '#0f0', '#f00', '#00f']; // Confetti colors
            for (let i = 0; i < 50; i++) { // Generate 50 confetti particles
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                // Random starting position within the game wrapper
                const startX = Math.random() * gameBoard.offsetWidth;
                const startY = Math.random() * gameBoard.offsetHeight;
                confetti.style.left = `${startX}px`;
                confetti.style.top = `${startY}px`;

                // Random end position for falling effect
                const endX = (Math.random() - 0.5) * 400 + startX; // +/- 200px from startX
                const endY = (Math.random() * 300) + gameBoard.offsetHeight; // Fall downwards
                confetti.style.setProperty('--x', `${endX}px`);
                confetti.style.setProperty('--y', `${endY}px`);

                gameBoard.appendChild(confetti);

                // Remove confetti after animation
                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }
        }

        /**
         * Generic function to handle image uploads and save to localStorage.
         * @param {Event} event - The change event from the file input.
         * @param {string} storageKey - The localStorage key to save the image URL.
         * @param {function} callback - Callback function to run after image is loaded.
         */
        function handleImageUpload(event, storageKey, callback) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageUrl = e.target.result;
                    localStorage.setItem(storageKey, imageUrl);
                    if (callback) callback(imageUrl);
                    initializeGame('reset'); // Re-initialize game to apply new images
                };
                reader.readAsDataURL(file);
            } else {
                logDebugError(translations[currentLang].uploadErrorMessage(storageKey));
            }
        }

        /**
         * Handles all commands from the terminal input.
         * @param {string} command - The command string from the input.
         */
        function handleTerminalCommand(command) {
            command = command.trim(); // Trim whitespace
            const lowerCaseCommand = command.toLowerCase(); // For case-insensitive checks
            const t = translations[currentLang]; // Get current language translations

            passwordInput.value = ''; // Always clear input after processing
            toggleCardNumberVisibility(null); // Hide any displayed numbers by default

            if (lowerCaseCommand === t.cmd_secret_code) {
                showMessage(t.bombLocation(bombIndex + 1));
            } else if (lowerCaseCommand === t.cmd_debug) {
                debugPanel.classList.add('show');
            } else if (lowerCaseCommand === t.cmd_clear) {
                showMessage(t.cardNumberHidden);
            } else if (lowerCaseCommand === t.cmd_promo_hide) { // Secret code to hide UI
                initializeGame('0000_activate'); // Activate promo mode
                showMessage(t.promoModeActivated);
            } else if (lowerCaseCommand === t.cmd_promo_show) { // Command to show UI
                initializeGame('-0_deactivate'); // Deactivate promo mode
                showMessage(t.uiRestored);
            } else if (lowerCaseCommand === t.cmd_reset || lowerCaseCommand === t.cmd_restart_game) { // Restart game
                initializeGame('reset'); // This will also deactivate promo mode
                showMessage(t.gameReset);
            } else if (lowerCaseCommand === t.cmd_shuffle) { // Shuffle but keep board color, preserve promo mode
                initializeGame('shuffle'); // 'shuffle' mode (new random card colors, board bg unchanged)
                showMessage(t.gameShuffled);
            } else if (lowerCaseCommand === t.cmd_smooth_bg) { // Smooth background, only randomize card colors
                initializeGame('smooth-bg');
                showMessage(t.smoothBgActivated);
            } else if (lowerCaseCommand === t.cmd_show_all_numbers) { // Show all numbers
                toggleCardNumberVisibility('all');
                showMessage(t.showingAllNumbers);
            } else if (lowerCaseCommand.startsWith(t.cmd_show_specific_number_prefix.toLowerCase()) && lowerCaseCommand.endsWith(t.cmd_show_specific_number_suffix.toLowerCase())) {
                const numStr = command.substring(command.indexOf('(') + 1, command.lastIndexOf(')'));
                const num = parseInt(numStr);
                if (!isNaN(num) && num >= 1 && num <= TOTAL_CARDS) {
                    toggleCardNumberVisibility(num);
                    showMessage(t.showingSpecificNumber(num));
                } else {
                    showMessage(t.invalidNumberFormat);
                    logDebugError(t.invalidNumberFormat);
                }
            } else if (lowerCaseCommand === t.cmd_lang_en) {
                setLanguage('en');
                showMessage(translations['en'].uiRestored); // Show message in new language
            } else if (lowerCaseCommand === t.cmd_lang_id) {
                setLanguage('id');
                showMessage(translations['id'].uiRestored); // Show message in new language
            } else if (lowerCaseCommand === t.cmd_help) {
                helpPanel.classList.add('show'); // Show help panel
            } else if (command === '') { // Empty input, show all numbers
                toggleCardNumberVisibility('all');
                showMessage(t.showingAllNumbers);
            }
            else {
                showMessage(t.invalidSecretCode);
                logDebugError(t.unknownCommand(command));
            }
            updateDebugPanel(); // Update debug panel after command
        }


        // --- Event Listeners ---
        window.onload = function() {
            // Assign DOM element references here
            gameTitleMeta = document.getElementById('game-title-meta');
            gameTitle = document.getElementById('game-title');
            labelThemeSelect = document.getElementById('label-theme-select');
            optionLight = document.getElementById('option-light');
            optionDark = document.getElementById('option-dark');
            optionForest = document.getElementById('option-forest');
            labelUploadBoardBg = document.getElementById('label-upload-board-bg');
            labelUploadBombImg = document.getElementById('label-upload-bomb-img');
            labelUploadNonBombImg = document.getElementById('label-upload-non-bomb-img');
            gameBoard = document.getElementById('game-board');
            gameBoardCard = document.getElementById('game-board-card');
            backgroundUpload = document.getElementById('background-upload');
            bombImageUpload = document.getElementById('bomb-image-upload');
            nonBombImageUpload = document.getElementById('non-bomb-image-upload');
            passwordInput = document.getElementById('password-input');
            revealBombButton = document.getElementById('reveal-bomb-button');
            shuffleButton = document.getElementById('shuffle-button');
            resetButton = document.getElementById('reset-button');
            messageBox = document.getElementById('message-box');
            messageText = document.getElementById('message-text');
            closeMessageButton = document.getElementById('close-message');
            themeSelect = document.getElementById('theme-select');
            debugToggleButton = document.getElementById('debug-toggle-button');
            debugPanel = document.getElementById('debug-panel');
            debugCloseButton = document.getElementById('debug-close-button');
            debugPanelTitle = document.getElementById('debug-panel-title');
            debugLabelBombIndex = document.getElementById('debug-label-bomb-index');
            debugBombIndex = document.getElementById('debug-bomb-index');
            debugLabelRevealedCount = document.getElementById('debug-label-revealed-count');
            debugRevealedCount = document.getElementById('debug-revealed-count');
            debugLabelIsGameOver = document.getElementById('debug-label-is-game-over');
            debugIsGameOver = document.getElementById('debug-is-game-over');
            debugLabelActiveTheme = document.getElementById('debug-label-active-theme');
            debugActiveTheme = document.getElementById('debug-active-theme');
            debugLabelBombUrl = document.getElementById('debug-label-bomb-url');
            debugBombUrl = document.getElementById('debug-bomb-url');
            debugLabelNonBombUrl = document.getElementById('debug-label-non-bomb-url');
            debugNonBombUrl = document.getElementById('debug-non-bomb-url');
            debugLabelErrorMessages = document.getElementById('debug-label-error-messages');
            debugErrorMessages = document.getElementById('debug-error-messages');

            helpPanel = document.getElementById('help-panel');
            helpCloseButton = document.getElementById('help-close-button');
            helpPanelTitle = document.getElementById('help-panel-title');
            commandsTableBody = document.getElementById('commands-table-body');
            tableHeaderCommand = document.getElementById('table-header-command');
            tableHeaderDescription = document.getElementById('table-header-description');


            // Image Uploads
            backgroundUpload.addEventListener('change', (e) => handleImageUpload(e, BACKGROUND_STORAGE_KEY, (url) => {
                gameBoardCard.style.backgroundImage = `url('${url}')`;
                gameBoardCard.style.backgroundColor = 'transparent';
            }));
            bombImageUpload.addEventListener('change', (e) => handleImageUpload(e, BOMB_IMAGE_STORAGE_KEY, (url) => {
                BOMB_IMAGE_URL = url;
            }));
            nonBombImageUpload.addEventListener('change', (e) => handleImageUpload(e, NON_BOMB_IMAGE_STORAGE_KEY, (url) => {
                NON_BOMB_IMAGE_URL = url;
            }));

            // Theme Selector
            themeSelect.addEventListener('change', (e) => applyTheme(e.target.value));

            // Password Input (Terminal) Logic - handles Enter key press
            passwordInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent default form submission
                    handleTerminalCommand(this.value); // Process command on Enter
                }
            });

            // "Enter / Click" Button Logic - processes commands on click
            revealBombButton.addEventListener('click', function() {
                handleTerminalCommand(passwordInput.value);
            });


            // Game Control Buttons
            shuffleButton.addEventListener('click', () => initializeGame('shuffle')); // Updated mode
            resetButton.addEventListener('click', () => initializeGame('reset')); // Updated mode
            closeMessageButton.addEventListener('click', hideMessage);

            // Debugging Toggle & Close Button
            debugToggleButton.addEventListener('click', () => {
                debugPanel.classList.toggle('show');
            });
            debugCloseButton.addEventListener('click', () => {
                debugPanel.classList.remove('show');
            });

            // Help Panel Close Button
            helpCloseButton.addEventListener('click', () => {
                helpPanel.classList.remove('show');
            });

            // --- Initial Load ---
            // Load and apply saved language
            const savedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY) || 'id';
            setLanguage(savedLang); // Apply language first
            populateHelpTable(); // Populate table after language is set

            // Load and apply saved theme
            const savedTheme = localStorage.getItem(THEME_STORAGE_KEY) || 'light';
            themeSelect.value = savedTheme;
            applyTheme(savedTheme);

            // Load saved background image
            const savedBackground = localStorage.getItem(BACKGROUND_STORAGE_KEY);
            if (savedBackground) {
                gameBoardCard.style.backgroundImage = `url('${savedBackground}')`;
                gameBoardCard.style.backgroundColor = 'transparent';
            } else {
                // If no saved background, set initial default black
                gameBoardCard.style.backgroundColor = '#000000';
            }

            initializeGame('initial'); // Initialize the game board in initial mode
            updateDebugPanel(); // Initial debug panel update
        };
    </script>
</body>
</html>

